<h1>Chessboard</h1>

<table id='chessboard'>
  <% ((7).downto(0)).each do |y| %>
    <tr>
    <% (0..7).each do |x| %>
      <td class="droppable" data-x="<%= x %>" data-y="<%= y %>">
      <% piece = Piece.find_by(x_position: x, y_position: y, game_id: @game.id) %>
      	<% if piece.present? %>
      		<div class="piece draggable" data-black="<%= piece.is_black %>" data-id="<%= piece.id %>"><%= piece.unicode.html_safe %></div>
        <% end %>
      </td>
    <% end %>
  <% end %>
</table>


<script>
  $(document).ready(function () {
    $(".draggable").draggable({
      helper: "clone",
    });
    $(".droppable").droppable({
      
      drop: function( event, ui) {
        
        var id = ui.draggable.data('id')
        var x = $(this).data('x')
        var y = $(this).data('y')
      
        
        $.ajax({
          type: 'PUT',
           url: '/pieces/' + id,
           dataType: 'json',
           data: { id: id, x_position: x, y_position: y},
           success: function(data){
            location.reload();
           }
        });

        // $(this).append(ui.draggable);
      }
    });
  });
</script>


<%= link_to 'Forefeit Game', forfeit_game_game_path, method: :post, data: {confirm: 'Are you sure you want to forfeit?'},class: 'btn btn-secondary' %>


